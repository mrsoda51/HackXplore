<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Glass Container Monitor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
    }
    .dashboard {
      display: flex;
      gap: 20px;
      padding: 20px;
    }
    .controls {
      width: 250px;
      background-color: white;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .controls label,
    .controls select,
    .controls input,
    .controls button {
      width: 100%;
      margin-bottom: 10px;
    }
    .map {
      flex: 1;
      background-color: #ddd;
      height: 400px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      margin: 20px;
      text-align: center;
    }
    .stat {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex: 1;
      margin: 0 10px;
    }
    .stat h3 {
      margin: 0;
      font-size: 1.1rem;
      color: #555;
    }
    .stat p {
      font-size: 1.5rem;
      font-weight: bold;
      color: #222;
    }
  </style>
</head>
<body>
<header>Glass Container Monitor</header>
<div class="dashboard">
  <div class="controls">
    <label for="day-select">Select Day</label>
    <select id="day-select">
      <option value="2024-01-21">Day 1</option>
      <option value="2024-01-22">Day 2</option>
      <option value="2024-01-23">Day 3</option>
      <option value="2024-01-24">Day 4</option>
      <option value="2024-01-25">Day 5</option>
    </select>

    <label for="hour-slider">Hour (simulated)</label>
    <input type="range" min="0" max="5" value="0" id="hour-slider" />
    <p id="hour-label">06:00</p>

    <button id="load-btn">Load Data</button>

    <label for="type-filter">Container Type</label>
    <select id="type-filter">
      <option value="all">All Types</option>
      <option value="W">White Glass (W)</option>
      <option value="G">Green Glass (G)</option>
      <option value="B">Brown Glass (B)</option>
    </select>

    <label for="district-filter">District</label>
    <select id="district-filter">
      <option value="all">All Districts</option>
    </select>

  </div>

  <div class="map" id="map">[Map will go here]</div>
</div>

<div class="stats">
  <div class="stat">
    <h3>Total Containers</h3>
    <p id="total-containers">0</p>
  </div>
  <div class="stat">
    <h3>Critical Containers</h3>
    <p id="critical-containers">0</p>
  </div>
  <div class="stat">
    <h3>Average Fill Level</h3>
    <p id="avg-fill-level">0%</p>
  </div>
  <div class="stat">
    <h3>Container Type Breakdown</h3>
    <p id="type-breakdown">W: 0 | G: 0 | B: 0</p>
  </div>
</div>

<script>
  const TIME_OPTIONS = ["06:00", "08:00", "10:00", "12:00", "14:00", "18:00"];

  const daySelect = document.getElementById("day-select");
  const hourSlider = document.getElementById("hour-slider");
  const hourLabel = document.getElementById("hour-label");
  const loadBtn = document.getElementById("load-btn");

  const typeFilter = document.getElementById("type-filter");
  const districtFilter = document.getElementById("district-filter");


  const totalEl = document.getElementById("total-containers");
  const criticalEl = document.getElementById("critical-containers");
  const avgEl = document.getElementById("avg-fill-level");
  const breakdownEl = document.getElementById("type-breakdown");

  let allData = [];

  function renderStats(time) {
    const selectedType = document.getElementById("type-filter").value;
    const selectedDistrict = document.getElementById("district-filter").value;

    // Filter the data
    const filtered = allData.filter(d =>
            d.time === time &&
            (selectedType === "all" || d.containerId.endsWith(selectedType)) &&
            (selectedDistrict === "all" || d.district === selectedDistrict)
    );

    // Total containers at this hour
    totalEl.textContent = filtered.length;

    // Critical containers (>=90%)
    criticalEl.textContent = filtered.filter(c => c.fillLevel >= 90).length;

    // Average fill level
    const avg = filtered.length
            ? (filtered.reduce((sum, c) => sum + c.fillLevel, 0) / filtered.length).toFixed(1)
            : 0;
    avgEl.textContent = `${avg}%`;

    // Type breakdown: W/G/B
    const types = { W: 0, G: 0, B: 0 };
    filtered.forEach(c => {
      const type = c.containerId.slice(-1);
      if (types[type] !== undefined) types[type]++;
    });
    breakdownEl.textContent = `W: ${types.W} | G: ${types.G} | B: ${types.B}`;
  }

  typeFilter.addEventListener("change", () => {
    const time = TIME_OPTIONS[hourSlider.value];
    renderStats(time);
  });

  districtFilter.addEventListener("change", () => {
    const time = TIME_OPTIONS[hourSlider.value];
    renderStats(time);
  });


  hourSlider.addEventListener("input", () => {
    const time = TIME_OPTIONS[hourSlider.value];
    hourLabel.textContent = time;
    renderStats(time);
  });

  loadBtn.addEventListener("click", () => {
    const selectedDate = daySelect.value;

    fetch(`http://localhost:8080/api/containers?date=${selectedDate}`)
            .then(res => res.json())
            .then(data => {
              allData = data;

              const time = TIME_OPTIONS[hourSlider.value];
              hourLabel.textContent = time;

              // âœ… Populate district dropdown
              const districtSet = new Set(data.map(d => d.district));
              const districtSelect = document.getElementById("district-filter");
              districtSelect.innerHTML = '<option value="all">All Districts</option>';
              districtSet.forEach(d => {
                const opt = document.createElement("option");
                opt.value = d;
                opt.textContent = d;
                districtSelect.appendChild(opt);
              });

              renderStats(time);
            })
            .catch(err => {
              alert("Failed to load data: " + err.message);
            });
  });

</script>

</body>
</html>
